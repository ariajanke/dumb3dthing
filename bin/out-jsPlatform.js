const jsPlatform=(()=>{"use strict";const R=()=>{},w=Symbol(),F=(()=>{let t={};const u=r=>(r&r-1)==0,c=(r,s)=>(e,A)=>{if(t[r].texture){if(A)throw"Cache Safety: textureLoader's cache was no invalided";return t[r].texture}const E=e.createTexture();e.bindTexture(e.TEXTURE_2D,E);const b=0,n=e.RGBA,i=1,d=1,U=0,y=e.RGBA,h=e.UNSIGNED_BYTE,o=new Uint8Array([0,0,255,255]);return e.texImage2D(e.TEXTURE_2D,b,n,i,d,U,y,h,o),e.bindTexture(e.TEXTURE_2D,E),e.texImage2D(e.TEXTURE_2D,b,n,y,h,s),u(s.width)&&u(s.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),t[r].texture=E};return Object.freeze({invalidateTextureCache:()=>{Object.keys(t).forEach(r=>{delete t[r].texture,t[r].texture=void 0})},loadImage:(r,s)=>{t[r]&&s(c(r,t[r].image));const e=new Image;e.onload=()=>{t[r]={image:e},s(c(r,e))},e.src=r}})})(),M=()=>{let t,u,c,f,r;const s=e=>{c=u(t,e),f=t[`TEXTURE${r}`]};return Object.freeze({setContext:e=>{t=e,c=void 0,!!u&&s()},height:()=>{throw"idk what to do"},width:()=>{throw"idk what to do"},load:e=>F.loadImage(e,A=>{console.log(`Loading image for ${e} complete.`),u=A}),bind:e=>{if(!c){if(!u){console.log("Cannot bind texture yet! Skipping!");return}console.log("Refreshing texture on bind call."),s()}t.activeTexture(f),t.bindTexture(t.TEXTURE_2D,c),e(r)},getNativeTexture:()=>c,setUnit:e=>R(r=e),getUnit:()=>r,destroy:()=>{}})},_=()=>{let t,u,c,f,r,s;const e=(n,i)=>{const d=t.createBuffer();return t.bindBuffer(n,d),t.bufferData(n,i,t.STATIC_DRAW),d},A=(n,i,d)=>{t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(i,d,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i)},E=(n,i,d)=>(s=b(n,i,d))(),b=(n,i,d)=>(r=d.length,()=>{u=e(t.ELEMENT_ARRAY_BUFFER,d),c=e(t.ARRAY_BUFFER,n),f=e(t.ARRAY_BUFFER,i)});return Object.freeze({setContext:n=>{t=n,s&&s()},load:E,loadFromJsArrays:(n,i,d)=>E(new Float32Array(n),new Float32Array(i),new Uint16Array(d)),render:(n,i)=>{A(c,n,3),A(f,i,2),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.drawElements(t.TRIANGLES,r,t.UNSIGNED_SHORT,0)},destroy:()=>{}})};return(()=>{let t=()=>{throw"jsPlatform.bindTexture: must setTextureUnitHandler before use."},u=()=>{throw"jsPlatform.renderRenderModel: must setRenderModelAttributesNeeder before use."},c=()=>{throw""};const f=o=>{let p=0,m={},a;return[x=>{const l=x??p++;if(m[l])throw`indexMap.create: key "${l}" already in use.`;return m[l]=o(),m[l].setContext(a),l},x=>{m[x].destroy(),delete m[x]},x=>{const l=m[x];if(!l)throw"Did you forget to initialize this resource with the create function?";return l},x=>{Object.keys(m).forEach(l=>m[l].setContext(x)),a=x}]},r=(()=>{const o=[0,1,0],p=[1,0,0],m=[0,0,1];let a,x=()=>{throw"modelMatrix.apply: applier must be set before use."},l=()=>{throw"modelMatrix.setContext: applier factor not set."};return Object.freeze({setContext:T=>R(x=l(T)),rotateY:T=>mat4.rotate(a,a,T,o),rotateX:T=>mat4.rotate(a,a,T,p),rotateZ:T=>mat4.rotate(a,a,T,m),translate:T=>mat4.translate(a,a,T),reset:()=>R(a=mat4.create()),apply:()=>x(a),setApplierFactory:T=>R(l=T)})})(),s=(()=>{let o=mat4.create(),p,m=()=>{throw"viewMatrix.apply: applier must be set before use."};return Object.freeze({setContext:a=>R(m=p(a)),lookAt:(a,x,l)=>mat4.lookAt(o,a,x,l),apply:()=>m(o),setApplierFactory:a=>R(p=a)})})(),[e,A,E,b]=f(M),[n,i,d,U]=f(_),y=[U,b,s.setContext,r.setContext];let h=()=>{throw""};return Object.freeze({setContext:o=>{F.invalidateTextureCache(),y.forEach(p=>p(o)),u=c(o),t=h(o)},createTexture:e,destroyTexture:A,getTexture:E,createRenderModel:n,destroyRenderModel:i,getRenderModel:d,renderRenderModel:o=>u(d(o).render),bindTexture:o=>E(o).bind(t),modelMatrix:r,viewMatrix:s,setTextureUnitHandlerFactory:o=>R(h=o),setRenderModelAttributesNeederFactory:o=>R(c=o)})})()})();
